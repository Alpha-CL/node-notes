# node internet

#### net

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * request http
 * 
 * 
 */

1) 普通模式: 三次握手 ==> 请求一次，响应一次 ==> 四次挥手

2) 长连接模式: 三次握手 ==> 短时间内可不断响应请求，无需多次请求 ==> 四次挥手


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * net          // 通信模块
 * 
 * 
 * 可利用该模块实现: "进程间通信 IPC" / "网络通信 TCP/IP"
 */


//-------------------------------------------------------------------------------------------------------------------//


/**
 * net.createConnection(options [, connectListener]): scoket;
 * 
 * 
 * 创建服务器
 * 
 * return: socket: 1) 是一个特殊的文件
 *                 2) 在 node 中 socket 为一个双工流对象
 *                 3) 通过向 socket 中写入内容发送数据
 *                 4) 通过监听 socket 中的内容获取数据
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * net.createServer(): server;
 * 
 * 
 * return: server.listen(port);                     // 监听当前计算机中的指定借口
 *         server.on('listening', ()=>{});          // 开启监听端口后及触发的事件
 *         server.on('connection', scoket=>{});     // 当某个连接到来时，及触发该事件( 事件监函数会获得一个 socket 对象 )
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### http

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * http                 // http 模块建立在 net 模块之上
 *                      // 1) 无须手动管理 socket
 *                      // 2) 无须手动组装消息格式
 * 
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * http.request(url [, options][, callback]);               // 向服务器请求
 * http.createServer([options][, requestListener]);         // 创建服务器
 * 
 * 
 */


// 总结

Client: {
    
    request: ClientRequuest_Object
    response: IncomingMessage_Object
}

Server: {

    request: IncomingMessage_Object
    response: ServerResponse_Object
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### http protocol

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 对称加密
 * 
 * 
 * 产生一个密钥，可以用其 '加密'，也可以用其 '解密'
 * 
 ** 常用算法: DES, 3DES, AES, Blowfish ...
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


Secret: only_key


// encryption: 
                                               + -- key -- +
    + -------- +        + ----------- +        |           |
    |   data   |   +    |  only_key   |   =    |   data    |
    + -------- +        + ----------- +        |           |
                                               + --------- +

// Decrypt:

    + -- key -- +
    |           |       + ----------- +        + -------- +
    |   data    |   +   |  only_key   |   =    |   data   |
    |           |       + ----------- +        + -------- +
    + --------- +


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 非对称加密
 * 
 * 
 * 产生一对密钥，一个用于 '加密'，一个用于 '解密'
 * 
 ** 常用算法: RSA, Elgamal, Rabin , D-H, ECC ...
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


Secret: common_key & personal_key


// encryption: 
                                                 + -- key -- +
    + -------- +        + ------------- +        |           |
    |   data   |   +    |  common_key   |   =    |   data    |
    + -------- +        + ------------- +        |           |
                                                 + --------- +

// Decrypt:

    + -- key -- +
    |           |       + --------------- +        + -------- +
    |   data    |   +   |  personal_key   |   =    |   data   |
    |           |       + --------------- +        + -------- +
    + --------- +


//-------------------------------------------------------------------------------------------------------------------//


/**
 * CA: Certificate Authority                // 证书颁发机构
 * 
 * 
 * 由于证书中的 "服务器公钥"，"证书签名" 是通过 CA 的 私钥加密的
 * 因此，其他终端只能通过 CA 的公钥解密读取，但无法重新加密伪造
 */

    persnoal -----> common_key ------> CA: {  common_key, personal_key  }
       /|           domian_name                         |
        |           money                               |
        |                                               |/
        + <-------------- certificate ----------------- +
                             证书

/**
 * 证书签名( Signature ) <= domain_name + CA-common_key + personal-common_key
 * 
 * 
 * 证书签名的算法是公开的，证书签名是为了验证 "证签名( 将公共信息以一种算法组合起来 )" 是否被篡改
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


1) 浏览器获取 CA 证书

2) 浏览器验证 CA 证书

3) 浏览器生成对称加密

4) 将对称加密由 CA.common_key 加密

5) ...



//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/** 若该网站是通过 https 获取的，则该网站的其他资源均应使用 https 协议获取 **/


        http                https
        
        TCP/IP              SSL
        
                            TCP/IP


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 服务器结构
 * 
 * 
 * 
 */


    + -- Browser -- +               + --- Server -- +
    |               |    request    |               |
    |               | ------------> |     node      |
    |               |               |     https     |
    |               | <------------ |     443       |
    |               |    response   |               |
    + ------------- +               + ------------- +

    // 实际开发中

    + -- Browser -- +               + ----------------- Server ---------------- +
    |               |               |                                           |
    |               |               |   +----------- +         +----------- +   |
    |               |    request    |   |            |         |            |   |
    |               | ------------> |   |   nginx    | ------> |    node    |   |
    |               |               |   |   https    |         |    http    |   |
    |               | <------------ |   |   443      | <------ |    port    |   |
    |               |    response   |   |            |         |            |   |
    |               |               |   +----------- +         +----------- +   |
    |               |               |                                           |
    + ------------- +               + ----------------------------------------- +


//-------------------------------------------------------------------------------------------------------------------//


/** 准备证书 **/


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * method_01: 网上购买权威机构证书
 * 
 * 
 * 
 */

          money +
                |
         server + => deploy       
                |
    domain_name +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * method_02: 本地产生证书
 * 
 * 
 * 自己作为权威机构颁发证书( 仅用于学习和测试 )
 */

1) 安装 openssl

    * 下载并安装 openssl，添加环境变量( 以供全局使用 openssl )

2) 生成 CA私钥

    * cmd: openssl genrsa -des3 -out ca-pri-key.pem 1024
        - genrsa: 密钥对生成算法
        - des3: 使用对称加密算法 des3 对私钥进一步加密
        - out ca-pri-key.pem: 将加密后的私钥保存到当前目录的ca-pri-key.pem文件中
        - 1024: 私钥的字节数

3) 生成 CA公钥( 证书请求 )

    * cmd: openssl req -new -key ca-pri-key.pem -out ca-pub-key.pem
        - 通过私钥文件ca-pri-key.pem中的内容，生成对应的公钥，保存到ca-pub-key.pem中
        - 运行过程中要使用之前输入的密码来实现对私钥文件的解密
        *  其他输入信息
            - Country Name：国家名  CN
            - Province Name：省份名 Sichuan
            - Local Name：城市名
            - Company Name：公司名
            - Unit Name：部门名
            - Common Name：站点名
            - ...

4) 生成 CA 证书

    * cmd: openssl x509 -req -in ca-pub-key.pem -signkey ca-pri-key.pem -out ca-cert.crt
        - 使用X.509证书标准，通过证书请求文件ca-pub-key.pem生成证书，并使用私钥ca-pri-key.pem加密，然后把证书保存到ca-cert.crt文件中

5) 生成 服务器私钥

    * cmd: openssl genrsa -out server-key.pem 1024

6) 生成 服务器公钥

    * cmd: openssl req -new -key server-key.pem -out server-scr.pem

7) 生成 服务器证书

    * cmd: openssl x509 -req -CA ca-cert.crt -CAkey ca-pri-key.pem -CAcreateserial -in server-scr.pem -out server-cert.crt


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```
