# node life cycle

#### 

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * node event cycle
 * 
 * 
 * timer: 理论上存放计时器的回调函数队列
 * 
 * poll( 轮询队列 ): 除了 timers, checks，大部分回调都会放入该队列( eg: 文件的读取，监听用户请求 )
 *                  
 *                  * 运作方式: 
 *                      - 若 poll 中有回调: 依次执行，直到清空队列
 *                      - 若 poll 中无回调: 等待其他队列中出现回调，结束该阶段，进入下一阶段
 *                                         若其他队列也没有回调，则持续等待，直到出现回调为止
 * 
 * check( 检查阶段 ): 使用 setImmediate 回调会直接进入该队列 
 * 
 ** 事件循环循环中，每次准备执行一个回调之前，必先清空( 将微队列中的任务执行完后才执行宏队列 ) nextTick 和 promise 队列
 ** nextTick 在执行队列中优先级最高( 也属于微队列 )
 */
                                             ||
                                            \||/
                                             \/
                                    + ----------------- +
                                    |       mian        |
                                    + ----------------- +
                                             |
                                             |
       + ------------------ event_loop ----- + ----------------------------------------------------- +
       |                                     |                                                       |
       |       Microqueue                    |              Macroqueue                               |
       |                                     |                                                       |
       |                         |    + ========== +      + ---------- +      + ---------- +         |
       |    + ------------- +         |            |      |            |      |            |         |
       |    |               |    |    |   timers   | ---> |   pending  | ---> |   idle     |         |
       |    |   nextTick    |         |            |      |   callback |      |   preapre  |         |
       |    |               |    |    |            |      |            |      |            |         |
       |    + ------------- +         + ========== +      + ---------- +      + ---------- +         |
       |                         |                                                  |                |
       |    + ------------- +                + ------------------------------------ +                |
       |    |               |    |           |                                                       |
       |    |   Promise     |         + ========== +      + ========== +      + ------------- +      |
       |    |               |    |    ||          ||      |            |      |               |      |
       |    + ------------- +         ||   poll   || ---> |   check    | ---> |   close       |      |
       |                         |    ||          ||      |            |      |   callbacks   |      |
       |                              ||          ||      |            |      |               |      |
       |                         |    + ========== +      + ========== +      + ------------- +      |
       |                                                                             |               |
       + --------------------------------------------------------------------------- + ------------- +
                                                                                     |
                                                                                     |
                                                                            + ----------------- +
                                                                            |       over        |
                                                                            + ----------------- +
                                                                                     ||
                                                                                    \||/
                                                                                     \/


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```
