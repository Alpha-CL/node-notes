# Drive & orm

## mysql drive

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 什么是驱动程序
 * 
 * 
 * 驱动程序是连接内存和其他存储介质的桥梁
 * mysql驱动程序是连接内存数据和mysql数据的桥梁
 */

mysql_drive: mysql, mysql2( mysql-native )          // 两者借口几乎一致，mysql2 的优化较好一些

cmd: npm install --save mysql2


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 防止 sql 注入
 * 
 * 
 * 
 */

sql 注入: 用户通过注入 sql 语句到最终查询中，导致了整个 sql 与 预期行为不符

mysql 支持变量: 变量内容不作为任何 sql 关键字


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## orm

#### Object Relational Mapping

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * Object Relational Mapping
 * 
 * 
 * 通过 ORM 框架，可以自动的吧程序中的对象和数据库关联
 * ORM 狂降会隐藏具体的数据库底层细节，让开发者使用同样的数据操作API，完成对不同数据库的操作
 */

        // ORM 利用相同的 API 操作不同的数据库
        
                             + ------------ +
                             |              |           + ------------- +
                             |              | <======>  |     mysql     |
                             |              |           + ------------- +
                             |              |
    + -------- +        + -------- +        |           + ------------- +
    |          |        |          |        | <======>  |  mysql server |
    |          |        |          |        |           + ------------- +
    |          |        |          |        |
    |   Node   | <====> |  Common  |  ORM   |           + ------------- +
    |          |        |    API   |        | <======>  |     oracle    |
    |          |        |          |        |           + ------------- +
    |          |        |          |        |
    + -------- +        + -------- +        |           + ------------- +
                             |              | <======>  |     mongodb   |
                             |              |           + ------------- +
                             |              |                ... ...
                             + ------------ +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// ORM 优势

1) 开发者不用关心数据库，仅需关心对象

2) 可轻易完成数据库的移植

3) 无须拼接复杂的 sql语句，jishi


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// Node 中的 ORM

1) Sequelizee( JS & TS )

2) TypeORM

3) ... ... 


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### sequelizee

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// sequelize 仅作为工具，还需安装对应数据库驱动

# 安装 sequelize
$ npm install --save sequelize                                  // +1

# 安装数据库驱动
$ npm install --save pg pg-hstore # Postgres
$ npm install --save mysql2                                     // +1
$ npm install --save mariadb
$ npm install --save sqlite3
$ npm install --save tedious # Microsoft SQL Server


//-------------------------------------------------------------------------------------------------------------------//


// 三层架构

                + --------------------- +    
                |                       |
                |        Route          |           // 路由层
                |                       |           // 提供对外的 API 访问接口
                + --------------------- +    
                         /||\
                          ||
                         \||/
                + --------------------- +
                |                       |
                |       Service         |           // 服务层
                |                       |           // 提供业务逻辑的支持
                + --------------------- +
                         /||\
                          ||
                         \||/
                + --------------------- +
                |                       |
                |       DAO/DAL         |           // 数据访问层
                |                       |           // 提供与数据库或其他持久设备的通信，通常称为 ORM
                + --------------------- +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 数据验证位置
 * 
 * 
 * 相关第三方库: validator        // 验证某个 "字符串" 是否满足某个规则
 *             validate         // 验证某个 "对象的属性" 是否满足某些规则
 */

1) 前端( 客户端 ):           // 为了用户体验

2) 路由层:                  // 验证接口格式是否正常

3) 业务逻辑层:               // 保证业务完整性

4) 数据库验证( 约束 ):        // 保证数据完整性


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 一个完整的系统，最终的验证 一定在服务器
 * 
 * 
 * 
 */

1) 客户端: 用户体验验证( Browser, app, pad, miniprigram )

2) 服务器: 业务逻辑层验证( 为了业务逻辑的 完整性，安全性 )

3) 数据库: 为了保证数据的 完整性


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### dedicate data

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/** 利用第三方库，抓取数据 **/


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * axios                        // 获取服务器响应
 * 
 * 
 * 发送一个 http 请求，获取服务器的响应结果
 * 客户端和服务器通用
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * cheerio                      // 在响应的数据中筛选数据
 * 
 * 
 * Jquery 的核心库
 * 与 dom无关
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### momentjs

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * momentjs
 * 
 * 
 * 
 */

cmd: npm i moment


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * utc & 北京时间
 * 
 * 
 * utc 世界协调时，以英国格林威治时间为标准
 * utc时间和北京时间相差 8 小时( utc 凌晨 00:00 === 北京 上午 08:00 )
 */


eg

    utc: 1970-01-01 00:00:00 === beijing: 1970-01-01 08:00:00
    
    0 === 0             // 时间戳


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 时间戳
 * 
 * 
 * 某个 utc 时间至 1970-01-01 00:00:00 之间的毫秒数时间
 */

                                     时间戳

    1970-01-01 08:00:00     utc时间    0
    
    1970-12-31 20:00:00     北京时间    0
    
    1970-01-01 00:00:00     美国时间    0


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


        + ---------- +              + ---------- +              + ----------- +
        |            |              |            |              |             |
        |   Client   |     utc      |   Server   |     utc      |   database  |
        |            | -----------> |            | -----------> |             |
        |            |  timestamp   |            |  timestamp   |             |
        + ---------- +              + ---------- +              + ----------- +

        根据时间戳展示不同
        地区的本地时间


// 服务器

服务器可能会部署到世界的任何位置
服务器内部( 包括数据库 )应统一使用utc时间或时间戳

// 客户端

客户端要给不同地区的客户展示不同地区的本地时间
客户端应吧时间戳或utc时间转换巍峨本地时间显示


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### data verification

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 数据验证
 * 
 * 
 * 
 */

// 数据验证的位置

前端( 客户端 )               // 为了用户体验
路由层                      // 验证接口格式是否正常
业务逻辑层                   // 保证业务完整性
数据库验证                   // 保证数据完整性


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 相关库
 * 
 * 
 * 
 */

validator           // 用于验证某个字符串是否满足某个规则

validate            // 用于验证某个对象的树形是否满足某些规则


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 访问器 & 虚拟字段

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 访问器
 * 
 * 
 * get(); set();
 */


const Student = sequelize.define(
	'Student',
	{
		name: {
			type: DataTypes.STRING,
			allowNull: false
		},
		birthday: {
			type: DataTypes.DATE,
			allowNull: false,
			
			get() {             // 获取
			
				return this.getDataValue('birthday').getTime();
			},
			set() {             // 设置

			}
		},
};

//-------------------------------------------------------------------------------------------------------------------//


/**
 * 虚拟字段
 * 
 * 
 * type: DataTypes.VIRTUAL
 * 
 * 根据已有字段处理后产生一个新的字段，称为虚拟字段
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 日志记录

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * log4js               // 仅针对 node
 * 
 * 
 * 
 */


- level         // 日志级别

    * low - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - high
    * all --> trace --> debug --> info --> warn --> error --> fatal --> mark --> off

- category      // 日志分类

    * sql_log, request_log ...

- appender      // 日志出口

    * save as ?
    * format ?


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```





























