# basic nodejs

#### global

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * global           // node 中的全局变量( 类似于浏览器中的 window )
 * 
 * 
 * 
 */

npm i -D @types/node                // node 语法提示


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### api

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * node path/filename                   // 可省略文件后缀名
 * 
 * 
 * 执行指定文件
 */


//-------------------------------------------------------------------------------------------------------------------//


/**
 * setTimeout
 * setInterval
 * 
 * setImmediate
 * 
 * 
 */

setImmediate(()=>{}, 0); == setTimerout(()=>{}, duration);      // 类似于


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * console
 * 
 * 
 * 
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * __dirname            // 获取当前模块所在的目录
 * 
 * __filename           // 获取当前模块的文件路径
 * 
 * 
 * 并非 global 属性
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * Buffer               // 类型化数组( 继承自 UInt8Array )
 * 
 * 
 * 计算机中存储的基本单位: 字节
 * 使用/输出时，需使用 十六进制表示
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * process
 *      
 *      .cwd();                 // 返回当前 nodejs 进程工作目录的 绝对路径
 *      
 *      .exit();                // 强制退出当前 node 进程
 *      
 *      .argv();                // 获取命令中的 所有参数
 *      
 *      .platform();            // 获取命令中的所有参数
 *      
 *      .kill(pid);             // 根据 进程ID( pid: 由系统随机分配 ), 结束进程
 *      
 *      .env();                 // 获取环境变量
 * 
 * 
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### import file of path

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * require "path/file";                 // 根据路径倒入模块
 * 
 * 
 * node 最终会把 相对/绝对 转换为 绝对路径
 * 
 ** 倒入的路径 '//' 需转译 '//'
 */


1) 绝对路径: nodejs 会根据 绝对路径 引入 模块/文件

2) 相对路径( ./ or ../ ):

    - 相对于当前模块
    
    - 最终会将 相对路径 转换为 绝对路径，再根据 绝对路径倒入 模块/文件
    
    * 加载模块:                     // 无后缀名，及为倒入模块
    
        1. 检查是否是内置模块
        
        2. 检查当前目录中的 node_modules
        
        3. 检查上级目录中的 node_modules
        
        4. 将 相对路径 转换为 绝对路径
        
        5. 根据 绝对路径 加载模块

3) 后缀名:                         // 自动补全后缀名

        - .js .json .node .mjs

4) 文件名:                         // 若仅提供模块名文件名，则会自动匹配 index.js 作为入口文件

        - page.json {
        
            main: 'index.js',     // 表示模块的默认入口文件( 默认为: index.js )
                                  // 若匹配模块时，仅提供目录名，则使用该配置字段补全模块入口文件路径
            ...
        }


5) module_object                  // 记录当前模块信息

        - module {
            id: '',                             // 当前模块的编号( 绝对路径 )
                                                // 若是 入口模块 则为 '.'
                                                
            path: '',                           // 当前模块的绝对路径
            exports: {},                        // 当前模块导出的路径
            
            parent: Module {                    
                id: '',                         
                path: '',                       
                exports: {},                    
                parent: '',                     // 当前模块的父模块
                filename: '',                   // 当前模块的绝对路径
                loaded: false,                  // 当前模块是否加载完毕
                children: [ [Circular] ],       // 子模块
                paths: []                       // 若引入模块时，未明确路径，则会根据 paths 中的路径匹配
            },
            filename: '',                       
            loaded: false,                      
            children: [ [Circular] ],           
            paths: [],                          
        }

6) require_fn

        - require {
        
            resolve(),                  // 仅将匹配模块的 相对路径 转换为 绝对路径，并不会引入模块
            
            main: Module {              // 主模块信息
                id: '',
                path: '',
                exports: ''.
                parent: null,
                filename: '',
                loaded: false,
                children: [],
                path: []
            },
            
            extensions: [Object: null prototype] {      // 根据不同文件后缀匹配不同的函数
            
                '.js': [function],
                '.json': [function],
                '.node': [function],
                '.mjs': [function],
            },
            
            cache: [Object: null prototype] {           // 已缓存的模块
            
                'moduleID': Module {
                    id: '',
                    path: '',
                    ...
                },
                'moduleID': Module {
                    id: '',
                    path: '',
                    ...
                },
            }
        }


        - 当 匹配模块/require()，会将模块放置在一个函数中
        
        
        
        function require(modulePath) {
        
            1. require.resolve(); 将 modulePath( 相对路径 ) 转换为 绝对路径
            
            2. 在 require.cache 中判断是否已有该模块的缓存
            
                - 有: 则直接返回缓存中的 对应模块
                
                - 无: 
                    
                    1. 读取文件内容
                    
                    2. 将读取的文件内容，将该内容包裹在函数中
                    
                        // 包裹文件内容
                        function __temp(module, exports, require, __dirname, __filename) {
                        
                        }
                        
                        // 创建 module 对象
                        module.export = {};
                        const exports = module.exports;
                        __temp.call(module.exports, module, exports, require, module.path, moudle.filename);
                    
                        若不更改 module.export，则 this === export === module.export

            return module.export;               // 最终返回
        }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### commonjs vs es6

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 目前，Node 中的 ES模块 仍然处于 测试阶段
 * 
 * 
 * commonjs or es6 只能选择其一使用( 因引入模块所处理的环境不一样 )
 * 
 ** 当使用 es6 模块化运行时，必须添加 "node --experimental-modules demo.mjs" 标记
 */

1) commonjs

    module.export / module.exports
    require();

2) es6

    export '';
    import '';


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## basic module of nodejs 

### os

#### os.EOL

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.EOL: string;
 * 
 * 
 * \n           // macOs
 * \r\n         // windows
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.arch();

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.arch();
 * 
 * 
 * 获取当前计算机的 cpu
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.cpus();

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.cpus();
 * 
 * 
 * 获取当前计算机的 内核数组
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.freeman();

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.freeman
 * 
 * 
 * 获取当前计算机剩余内存空间
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.homedir

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.homedir
 * 
 * 
 * 获取当前计算机 用户目录路径
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.hostname

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.hostname
 * 
 * 
 * 获取当前计算机的 主机名
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### os.tmpdir

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * os.tmpdir
 * 
 * 
 * 获取当前计算机的 临时目录
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### path

#### path.basename();

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.basename( filename, ext ): pathname;
 * 
 * 
 * @ext: 文件格式后缀，若匹配成功，则返回去除文件后缀的 pathname 
 * 
 * 普遍情况:
 *  
 *      - filename: 指文件的 绝对路径
 *  
 *      - pathname: 指 文件名 
 * 
 * 
 * 根据指定路径返回 文件名
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### sperator

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/** path.sep/path.delimiter 会根据不同的操作系统显示不同的 分隔符  **/


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * path.sep
 * 
 * 
 * 
 * 
 * 多用于 同一块内容 的分割
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * path.delimiter
 * 
 * 
 * 多用于分割 不同的块
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.dirname

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.dirname( pathname ): dirname;
 * 
 * 
 * 根据文件路径，获取除文件外的目录路径
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.extname

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.extname( pathname ): extname;
 * 
 * 
 * 根据文件路径，获取文件的 后缀名
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.join();

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.join(pathstr...): pathname;
 * 
 * 
 * 将多段路径拼接为一个路径
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.normalize

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.normalize(path): normalizepath;
 * 
 * 
 * 根据路径，返回 规范后的路径( 路径中可能含有 ./ ../ )
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.relative

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.relative(path1, path2);
 * 
 * 
 * 返回 path2 相对于 path1 的相对路径
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### path.resolve

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * path.resolve();
 * 
 *
 ** 执行时，相对于 process 的路径，若需要相对当前模块路径则 path.resolve(__dirname, 'demo.js');
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### url

#### urlStr <==> urlObj

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * url
 * 
 * 
 */


const URL = require('url');

/** new URL.URL(url); 将 字符串路径 转换为 路径对象 **/
const url = new URL.URL('https://demo.com:80user/alpha?name=beta&age=18#666');

console.log(url);
// URL {
//     href: 'https://demo.com:80user/alpha?name=beta&age=18#666',
//     origin: 'https://demo.com:80',
//     protocol: 'https:',
//     username: '',
//     password: '',
//     host: '',
//     hostname: '',
//     port: '',
//     pathname: '',
//     search: '',
//     searchParams: URLSearchParams {},
//     hash: '#666'
// }

/** URl.format(urlObj); 将 路径对象 转换为 字符串路径 **/
const url = URL.format(urlObj);
console.log(url)


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### util

#### asyncFn <==> callbackFn

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * util.callbackify(asyncFn): callbackFn;
 * 
 * 
 * 将 异步函数 转换为 回调函数          // 多用于 统一规范 工程中的 异步处理
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


const util = require('util');

async function delay(duration) {

    return new Promise(resolve => {
    
        setTimeout(()=>{
        
            resove(duration);
            
        }, duration);
    });
}

delay(500)
    .then(d=>{
        console.log(d)
    });


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


const util = require('util');

async function delay(duration) {

    return new Promise(resolve => {
    
        setTimeout(()=>{
        
            resove(duration);
            
        }, duration);
    });
}

const delayCallback = util.callbackify(delay);

delayCallback(500, (err, d) => {

    console.log(d);
});


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * util.promisify(callbackFn): asyncFn;
 * 
 * 
 * 将 回调函数 转换为 异步函数          // 多用于 统一规范 工程中的 异步处理
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


function delayCallback(duration, callback) {

    setTimeout(()=>{
        
        callback(duration);
        
    }, duration);
}

const delay = util.promisify(delayCallback);

(async () => {

    const r = await delay(500);
    console.log(r);
    
})();


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### util.inherits()

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * util.inherits(chilClass， fatherClass);
 * 
 * 
 * 类继承
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### util.isDeepStrictEqual

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * util.isDeepStrictEqual(obj1, obj2): bool;
 * 
 * 
 * 深度 严格对比 对象
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```










